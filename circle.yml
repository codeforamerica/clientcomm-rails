machine:
  environment:
    TWILIO_PHONE_NUMBER: +12435551212
    TWILIO_AUTH_TOKEN: TWILIOAUTHTOKENTWILIOAUTHTOKENTWIL
    MIXPANEL_TOKEN: MIXPANELTOKENMIXPANELTOKENMIXPANEL
    SCHEDULED_MESSAGES: true

test:
  override:
    - RAILS_ENV=test bundle exec rspec -r rspec_junit_formatter --format documentation --format RspecJunitFormatter --out $CIRCLE_TEST_REPORTS/rspec/junit.xml
  post:
    - bundle exec codeclimate-test-reporter $CIRCLE_ARTIFACTS/coverage/.resultset.json
    - case $CIRCLE_NODE_INDEX in 0) ./script/brakeman ;; esac:
           parallel: true
    - case $CIRCLE_NODE_INDEX in 0) ./script/bundler-audit ;; esac:
           parallel: true
